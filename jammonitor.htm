<%+header%>

<style>
/* Hide LuCI header elements on small screens for quad-view */
@media (max-width: 900px) {
    header, .brand, #logo, .main > .main-left, .showSide,
    .container > header, #maincontent > header { display: none !important; }
    #maincontent { margin: 0 !important; padding: 0 !important; }
    .main { padding: 0 !important; }
}

/* Layout */
.jm-container { display: flex; min-height: 700px; }
.jm-sidebar { width: 180px; background: #2c3e50; padding: 10px 0; flex-shrink: 0; transition: width 0.2s; display: flex; flex-direction: column; }
.jm-sidebar-section { padding: 12px 15px 6px; font-weight: bold; color: #7f8c8d; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
.jm-sidebar-item { padding: 10px 20px; cursor: pointer; color: #ecf0f1; border-left: 3px solid transparent; transition: all 0.15s; white-space: nowrap; overflow: hidden; }
.jm-sidebar-item:hover { background: #34495e; }
.jm-sidebar-item.active { background: #3498db; border-left-color: #fff; font-weight: bold; }
.jm-main { flex: 1; padding: 20px; background: #ecf0f1; overflow-y: auto; }
.jm-view { display: none; }
.jm-view.active { display: block; }

/* Responsive sidebar - tablet */
@media (max-width: 1100px) {
    .jm-sidebar { width: 140px; }
    .jm-sidebar-item { padding: 8px 12px; font-size: 13px; }
    .jm-sidebar-section { padding: 10px 12px 4px; font-size: 9px; }
    .jm-main { padding: 15px; }
}

/* Responsive sidebar - mobile/quad-view */
@media (max-width: 900px) {
    .jm-sidebar { width: 50px; }
    .jm-sidebar-section { display: none; }
    .jm-sidebar-item {
        padding: 12px 8px;
        font-size: 0;
        text-align: center;
        border-left: none;
        border-bottom: 3px solid transparent;
    }
    .jm-sidebar-item.active { border-bottom-color: #fff; border-left: none; }
    .jm-sidebar-item::before {
        font-size: 16px;
        display: block;
    }
    .jm-sidebar-item[data-view="overview"]::before { content: "üìä"; }
    .jm-sidebar-item[data-view="wan-policy"]::before { content: "‚öñ"; }
    .jm-sidebar-item[data-view="links"]::before { content: "üîó"; }
    .jm-sidebar-item[data-view="clients"]::before { content: "üë•"; }
    .jm-sidebar-item[data-view="wifi-aps"]::before { content: "üì∂"; }
    .jm-sidebar-item[data-view="omr-status"]::before { content: "üñ•"; }
    .jm-sidebar-item[data-view="diagnostics"]::before { content: "üîß"; }
    .jm-sidebar-item[data-view="bw-realtime"]::before { content: "‚ö°"; }
    .jm-sidebar-item[data-view="bw-hourly"]::before { content: "‚è∞"; }
    .jm-sidebar-item[data-view="bw-daily"]::before { content: "üìÖ"; }
    .jm-sidebar-item[data-view="bw-monthly"]::before { content: "üìÜ"; }
    .jm-main { padding: 10px; }
    .jm-container { min-height: auto; }
}

/* Compact for smaller quadrants */
@media (max-width: 600px) {
    .jm-sidebar { width: 45px; }
    .jm-sidebar-item { padding: 10px 5px; }
    .jm-sidebar-item::before { font-size: 14px; }
    .jm-main { padding: 10px; }
    .jm-block { padding: 10px; min-height: auto; }
    .jm-big-value { font-size: 22px; }
    .jm-row { font-size: 11px; }
    h2 { font-size: 16px; margin-bottom: 10px; }
    .jm-health-tile { padding: 10px; }
    .jm-health-tile .tile-value { font-size: 22px; }
    .jm-health-tile .tile-label { font-size: 9px; }
}

/* Ultra-compact for very small quadrants */
@media (max-width: 450px) {
    .jm-sidebar { width: 36px; }
    .jm-sidebar-item { padding: 8px 4px; }
    .jm-sidebar-item::before { font-size: 12px; }
    .jm-main { padding: 6px; }
    .jm-block { padding: 8px; }
    .jm-block-header { margin-bottom: 6px; padding-bottom: 6px; }
    .jm-block-title { font-size: 11px; }
    .jm-big-value { font-size: 18px; }
    .jm-row { font-size: 10px; padding: 2px 0; }
    .jm-health-tile { padding: 8px; }
    .jm-health-tile .tile-value { font-size: 18px; }
    .jm-health-tile .tile-label { font-size: 8px; }
}

/* Settings button in sidebar */
.jm-settings-btn {
    margin-top: auto;
    padding: 12px 20px;
    border-top: 1px solid #3d5a73;
    cursor: pointer;
    color: #95a5a6;
    font-size: 15px;
    position: relative;
    transition: all 0.15s;
}
.jm-settings-btn:hover { background: rgba(255,255,255,0.1); color: #ecf0f1; }
.jm-settings-badge {
    position: absolute;
    top: 10px;
    right: 12px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #f39c12;
    display: none;
    animation: pulse-badge 2s infinite;
}
.jm-settings-badge.show { display: block; }
@keyframes pulse-badge {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(0.9); }
}
@media (max-width: 900px) {
    .jm-settings-btn { padding: 12px 8px; font-size: 0; text-align: center; }
    .jm-settings-btn::before { content: "üîß"; font-size: 16px; }
}
@media (max-width: 600px) {
    .jm-settings-btn { padding: 10px 5px; }
    .jm-settings-btn::before { font-size: 14px; }
}
@media (max-width: 450px) {
    .jm-settings-btn { padding: 8px 4px; }
    .jm-settings-btn::before { font-size: 12px; }
}

/* Settings popup overlay */
.jm-settings-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s, visibility 0.2s;
}
.jm-settings-overlay.show { opacity: 1; visibility: visible; }

/* Settings popup */
.jm-settings-popup {
    background: #fff;
    border-radius: 12px;
    width: 340px;
    max-width: 90%;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    transform: translateY(-20px);
    transition: transform 0.2s;
}
.jm-settings-overlay.show .jm-settings-popup { transform: translateY(0); }
.jm-settings-header {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #eee;
}
.jm-settings-header-icon { font-size: 18px; margin-right: 10px; }
.jm-settings-header-title { font-weight: 600; font-size: 16px; color: #2c3e50; flex: 1; }
.jm-settings-close {
    width: 28px;
    height: 28px;
    border: none;
    background: #f5f5f5;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}
.jm-settings-close:hover { background: #e0e0e0; }
.jm-settings-body { padding: 20px; }
.jm-settings-section { margin-bottom: 20px; }
.jm-settings-section:last-child { margin-bottom: 0; }
.jm-settings-label {
    font-size: 11px;
    font-weight: 600;
    color: #7f8c8d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
}
.jm-settings-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    background: #fff;
    cursor: pointer;
    transition: border-color 0.2s;
}
.jm-settings-select:hover { border-color: #bbb; }
.jm-settings-select:focus { outline: none; border-color: #3498db; }

/* Version card in settings */
.jm-version-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 14px;
    border: 1px solid #eee;
}
.jm-version-status-row {
    display: flex;
    align-items: center;
    gap: 10px;
}
.jm-version-status-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
}
.jm-version-status-icon.checking { background: #f5f5f5; color: #999; }
.jm-version-status-icon.up-to-date { background: #d4edda; color: #27ae60; }
.jm-version-status-icon.update-available { background: #fff3cd; color: #f39c12; }
.jm-version-status-icon.error { background: #f8d7da; color: #e74c3c; }
.jm-version-status-icon.updating { background: #cce5ff; color: #3498db; }
.jm-version-status-text { flex: 1; }
.jm-version-status-main { font-weight: 600; font-size: 14px; color: #2c3e50; }
.jm-version-status-sub { font-size: 12px; color: #7f8c8d; margin-top: 2px; }

/* Update button */
.jm-update-btn {
    width: 100%;
    margin-top: 12px;
    padding: 10px 16px;
    background: #3498db;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}
.jm-update-btn:hover { background: #2980b9; }
.jm-update-btn:disabled { background: #bdc3c7; cursor: not-allowed; }

/* Progress bar */
.jm-update-progress {
    margin-top: 12px;
    display: none;
}
.jm-update-progress.show { display: block; }
.jm-progress-label {
    font-size: 12px;
    color: #666;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
}
.jm-progress-bar {
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
}
.jm-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3498db, #2ecc71);
    border-radius: 4px;
    transition: width 0.3s ease-out;
    width: 0%;
}
.jm-progress-eta {
    font-size: 11px;
    color: #999;
    text-align: right;
    margin-top: 4px;
}

/* Collapsible sections */
.jm-collapsible-header { padding: 10px 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer; user-select: none; }
.jm-collapsible-header:hover { background: #ecf0f1; }
.jm-collapsible.expanded .jm-collapsible-header { border-radius: 8px 8px 0 0; }
.jm-remote-ap-item { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
.jm-remote-ap-item:last-child { border-bottom: none; }
.jm-remote-ap-status { width: 10px; height: 10px; border-radius: 50%; margin-right: 10px; }
.jm-remote-ap-status.online { background: #27ae60; }
.jm-remote-ap-status.offline { background: #e74c3c; }

/* Health blocks grid - 3x3 */
.jm-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
@media (max-width: 1200px) { .jm-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 600px) { .jm-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }
@media (max-width: 400px) { .jm-grid { grid-template-columns: 1fr; } }

.jm-block { background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); min-height: 180px; }
.jm-block-header { display: flex; align-items: center; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
.jm-block-title { font-weight: bold; font-size: 14px; color: #2c3e50; }
.jm-block-status { margin-left: auto; font-size: 11px; color: #7f8c8d; font-family: monospace; }

/* Compact interface cards */
.jm-block-compact { background: #fff; border-radius: 6px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); min-height: auto; }
.jm-block-compact .jm-block-header { margin-bottom: 6px; padding-bottom: 6px; }
.jm-block-compact .jm-big-value { font-size: 14px; margin: 2px 0; }
.jm-block-compact .jm-row { padding: 2px 0; font-size: 11px; }

/* Status indicators */
.jm-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; }
.jm-indicator.green { background: #27ae60; box-shadow: 0 0 6px #27ae60; }
.jm-indicator.yellow { background: #f39c12; box-shadow: 0 0 6px #f39c12; }
.jm-indicator.red { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
.jm-indicator.gray { background: #95a5a6; }

/* Big number display */
.jm-big-value { font-size: 26px; font-weight: bold; color: #2c3e50; font-family: 'Segoe UI', monospace; margin: 5px 0; }
.jm-big-label { font-size: 11px; color: #7f8c8d; text-transform: uppercase; }

/* Data rows */
.jm-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 13px; border-bottom: 1px solid #f5f5f5; }
.jm-row:last-child { border-bottom: none; }
.jm-label { color: #7f8c8d; }
.jm-value { font-family: monospace; color: #2c3e50; font-weight: 500; }

/* Mini graph canvas */
.jm-mini-graph { width: 100%; height: 50px; margin-top: 8px; }

/* Tables - compact rows */
table.jm-table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
table.jm-table th, table.jm-table td { padding: 6px 10px; text-align: left; }
table.jm-table th { background: #2c3e50; color: #fff; font-weight: 600; font-size: 12px; text-transform: uppercase; padding: 8px 10px; }
table.jm-table tr:nth-child(even) { background: #f8f9fa; }
table.jm-table tr:not(.bw-day-separator):hover { background: #e8f4fc; }

/* Client name inline editing - no layout shift on hover, buttons at bottom on click */
#clients-table td.client-name { cursor: pointer; position: relative; min-width: 140px; }
#clients-table td.client-name .name-display { line-height: 22px; }
#clients-table td.client-name .name-edit { position: absolute; top: 7px; left: 8px; right: 8px; display: none; z-index: 10; }
#clients-table td.client-name:hover .name-edit, #clients-table td.client-name.editing .name-edit { display: block; }
#clients-table td.client-name:hover .name-display, #clients-table td.client-name.editing .name-display { visibility: hidden; }
.name-edit input { width: 100%; padding: 4px 8px; border: 1px solid #3498db; border-radius: 4px; font-size: 13px; box-sizing: border-box; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
.name-edit input:focus { outline: none; border-color: #2980b9; box-shadow: 0 2px 8px rgba(52,152,219,0.3); }
/* Buttons absolutely positioned at bottom, cell padding creates space */
.name-edit-buttons { display: none; position: absolute; bottom: 8px; left: 8px; gap: 6px; }
#clients-table td.client-name.editing { padding-bottom: 42px; }
#clients-table td.client-name.editing .name-edit-buttons { display: flex; }
.name-edit-buttons button { padding: 5px 12px; font-size: 11px; font-weight: 600; border: none; border-radius: 4px; cursor: pointer; }
.name-edit-buttons .btn-save { background: #27ae60; color: #fff; }
.name-edit-buttons .btn-save:hover { background: #219a52; }
.name-edit-buttons .btn-cancel { background: #e0e0e0; color: #666; }
.name-edit-buttons .btn-cancel:hover { background: #d0d0d0; }
#clients-table td.client-name.cancelled .name-display { visibility: visible !important; }
#clients-table td.client-name.cancelled .name-edit { display: none !important; }
#clients-table td.client-name.cancelled .name-edit-buttons { display: none !important; }
/* Keep all cells aligned to top when row is being edited */
#clients-table tr.row-editing td { vertical-align: top; }
/* Placeholder for unnamed devices */
.name-placeholder { color: #95a5a6; font-style: italic; }

/* Offline client styling (Tailscale) */
.client-offline { color: #999; }
.client-offline td { color: #999; }
.client-offline td:nth-child(3) { text-decoration: line-through; }

/* Pending changes styling */
.client-pending { font-style: italic; }
.client-pending-name { background: #fff8e1; }
.client-pending-reservation { background: #e8f5e9; }

/* Reservation tag - button style */
.reservation-tag { cursor: pointer; text-align: center; }
.reservation-tag span {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 14px;
    background: #f5f5f5;
    border: 1px solid #ddd;
    transition: all 0.15s;
}
.reservation-tag span:hover {
    background: #e8f4fc;
    border-color: #3498db;
    transform: scale(1.05);
}
.reservation-tag span[style*="color:#27ae60"] {
    background: #e8f8e8;
    border-color: #27ae60;
}

/* Popup overlay */
.jm-popup-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; }
.jm-popup { background: #fff; border-radius: 12px; padding: 24px; min-width: 320px; max-width: 90%; box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
.jm-popup h3 { margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; }
.jm-popup-row { margin-bottom: 16px; }
.jm-popup-row label { display: block; font-size: 12px; color: #7f8c8d; text-transform: uppercase; margin-bottom: 6px; font-weight: 600; }
.jm-popup-row input { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
.jm-popup-row input:focus { outline: none; border-color: #3498db; }
.jm-popup-row input[readonly] { background: #f5f5f5; color: #7f8c8d; }
.jm-popup-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
.jm-popup-buttons button { padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; }
.jm-popup-buttons .btn-primary { background: #3498db; color: #fff; }
.jm-popup-buttons .btn-primary:hover { background: #2980b9; }
.jm-popup-buttons .btn-secondary { background: #ecf0f1; color: #2c3e50; }
.jm-popup-buttons .btn-secondary:hover { background: #dfe6e9; }
.jm-popup-buttons .btn-danger { background: #e74c3c; color: #fff; }
.jm-popup-buttons .btn-danger:hover { background: #c0392b; }
/* Bandwidth bucket popup */
.jm-popup-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
.jm-popup-header span { font-size: 16px; font-weight: 600; color: #2c3e50; }
.jm-popup-close { background: none; border: none; font-size: 24px; color: #7f8c8d; cursor: pointer; padding: 0; line-height: 1; }
.jm-popup-close:hover { color: #2c3e50; }
.jm-popup-body { max-height: 400px; overflow-y: auto; }
.jm-popup-footer { margin-top: 16px; padding-top: 12px; border-top: 1px solid #eee; text-align: right; }
.bw-bucket-popup { min-width: 700px; max-width: 90vw; }
.bw-bucket-table { width: 700px; font-size: 15px; border-collapse: collapse; table-layout: fixed; }
.bw-bucket-table th { text-align: left; padding: 8px 10px; background: #f8f9fa; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #e0e0e0; white-space: nowrap; overflow: hidden; }
.bw-bucket-table td { padding: 6px 10px; border-bottom: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.bw-bucket-table tr:hover { background: #f8f9fa; }
.bw-bucket-table th:nth-child(1) { width: 115px; } /* IP */
.bw-bucket-table th:nth-child(2) { width: 140px; } /* MAC */
.bw-bucket-table th:nth-child(3) { width: 100px; } /* Type */
.bw-bucket-table th:nth-child(4) { width: 100px; } /* Download */
.bw-bucket-table th:nth-child(5) { width: 100px; } /* Upload */
.bw-bucket-table th:nth-child(6) { width: 100px; } /* Total */
.bw-bucket-table th.sortable { cursor: pointer; user-select: none; transition: background 0.15s; }
.bw-bucket-table th.sortable:hover { background: #e8f4fc; }
.sort-icon { display: inline-block; width: 0; height: 0; margin-left: 6px; vertical-align: middle; border-left: 5px solid transparent; border-right: 5px solid transparent; }
.sort-icon.sort-asc { border-bottom: 6px solid #3498db; border-top: none; }
.sort-icon.sort-desc { border-top: 6px solid #3498db; border-bottom: none; }
.bw-bucket-loading { text-align: center; padding: 40px; color: #7f8c8d; }

/* Client table sorting and grouping */
#clients-table th.sortable { cursor: pointer; user-select: none; transition: background 0.15s; }
#clients-table th.sortable:hover { background: #d4e6f1; }
.client-group-header { background: #f8f9fa; cursor: pointer; font-weight: 600; }
.client-group-header:hover { background: #d4e6f1; }
.client-group-header td { padding: 8px 10px !important; }
.client-group-arrow { display: inline-block; transition: transform 0.2s; margin-right: 8px; font-size: 10px; }
.client-group-arrow.collapsed { transform: rotate(-90deg); }
.client-group-count { color: #7f8c8d; font-weight: normal; margin-left: 8px; font-size: 12px; }
.client-row.hidden { display: none; }
.bw-bucket-loading .chart-spinner { margin: 0 auto 12px auto; }
/* Clickable bandwidth time links */
.bw-time-link { color: #3498db; text-decoration: underline; cursor: pointer; transition: color 0.15s; }
.bw-time-link:hover { color: #2980b9; }
/* Hourly table day boundary separator - boring, ignorable divider */
tr.bw-day-separator, tr.bw-day-separator:hover,
table tr.bw-day-separator, table tr.bw-day-separator:hover,
table.jm-table tr.bw-day-separator, table.jm-table tr.bw-day-separator:hover,
table.jm-table tbody tr.bw-day-separator, table.jm-table tbody tr.bw-day-separator:hover {
    background: #bdc3c7 !important; box-shadow: none !important; outline: none !important;
}
tr.bw-day-separator td, table.jm-table tr.bw-day-separator td {
    padding: 6px 10px; color: #fff; text-align: left; font-size: 12px; font-weight: 600;
    letter-spacing: 0.3px; cursor: default; user-select: none; pointer-events: none;
}

/* Buttons */
.jm-btn { padding: 12px 24px; background: #3498db; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.2s; }
.jm-btn:hover { background: #2980b9; }
.jm-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
.jm-btn-sm { padding: 6px 12px; font-size: 12px; }
.jm-quick-range { padding: 8px 14px; background: #fff; color: #5a6c7d; border: 2px solid #e0e6ed; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; }
.jm-quick-range:hover { border-color: #3498db; color: #3498db; }
.jm-quick-range.active { background: #3498db; color: #fff; border-color: #3498db; }

/* Speed test rows */
.speedtest-row { display: flex; align-items: center; gap: 16px; padding: 14px 20px; background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; }
.speedtest-row .wan-ip { font-family: monospace; font-size: 12px; color: #7f8c8d; flex: 0 0 130px; }
.speedtest-row .wan-name { font-weight: 600; color: #2c3e50; flex: 0 0 160px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.speedtest-row .test-buttons { display: flex; gap: 8px; flex-shrink: 0; }
.speedtest-row .test-btn { padding: 8px 16px; font-size: 12px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.speedtest-row .test-btn.download { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
.speedtest-row .test-btn.download:hover:not(:disabled) { background: linear-gradient(135deg, #2980b9, #2471a3); }
.speedtest-row .test-btn.upload { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
.speedtest-row .test-btn.upload:hover:not(:disabled) { background: linear-gradient(135deg, #8e44ad, #7d3c98); }
.speedtest-row .test-btn:disabled { opacity: 0.6; cursor: not-allowed; }
.speedtest-row .status { flex: 1; text-align: right; font-size: 13px; color: #7f8c8d; min-width: 200px; }
.speedtest-row .result { font-weight: 600; color: #27ae60; }
.speedtest-row .result.error { color: #e74c3c; }
.speedtest-spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid #e0e0e0; border-top-color: #3498db; border-radius: 50%; animation: spin 1s linear infinite; }

/* Bandwidth controls */
.jm-bw-controls { background: #fff; border-radius: 8px; padding: 12px 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
.jm-bw-controls label { font-size: 13px; color: #7f8c8d; font-weight: 600; }
.jm-bw-controls select { padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
.jm-scale-btns { display: flex; gap: 5px; }
.jm-scale-btn { padding: 6px 12px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 12px; border-radius: 4px; }
.jm-scale-btn.active { background: #3498db; color: #fff; border-color: #3498db; }

/* Bandwidth chart */
.jm-chart-container { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); position: relative; }
.chart-loading { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.85); display: flex; align-items: center; justify-content: center; border-radius: 8px; z-index: 10; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
.chart-loading.active { opacity: 1; pointer-events: auto; }
.chart-spinner { width: 32px; height: 32px; border: 3px solid #e0e0e0; border-top-color: #3498db; border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.jm-chart { width: 100%; height: 250px; }
/* Chart tooltip */
.chart-tooltip { position: fixed; background: rgba(44, 62, 80, 0.95); color: #fff; padding: 10px 14px; border-radius: 6px; font-size: 12px; pointer-events: none; z-index: 9999; max-width: 200px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.chart-tooltip-title { font-weight: 600; margin-bottom: 6px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 6px; }
.chart-tooltip-row { display: flex; justify-content: space-between; gap: 12px; margin: 3px 0; }
.chart-tooltip-label { opacity: 0.8; }
.chart-tooltip-value { font-weight: 600; font-family: monospace; }

/* OMR Status iframe - cropped to hide LuCI navbar + submenu */
.jm-omr-frame-wrapper { overflow: hidden; border-radius: 8px; height: calc(100vh + 200px); min-height: 900px; }
.jm-omr-frame { width: 100%; height: calc(100% + 175px); border: none; background: #fff; margin-top: -175px; }

/* WiFi APs - Health tiles */
.jm-health-tiles { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
@media (max-width: 1000px) { .jm-health-tiles { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 500px) { .jm-health-tiles { grid-template-columns: repeat(2, 1fr); gap: 8px; } }
@media (max-width: 350px) { .jm-health-tiles { grid-template-columns: 1fr; } }
.jm-health-tile { background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); text-align: center; }
.jm-health-tile .tile-value { font-size: 28px; font-weight: bold; color: #2c3e50; }
.jm-health-tile .tile-label { font-size: 11px; color: #7f8c8d; text-transform: uppercase; margin-top: 5px; }

/* Status badges */
.jm-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
.jm-badge-online { background: #d4edda; color: #155724; }
.jm-badge-offline { background: #f8d7da; color: #721c24; }
.jm-badge-degraded { background: #fff3cd; color: #856404; }

/* AP List Editor */
.jm-ap-editor { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
.jm-ap-editor textarea { width: 100%; height: 100px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; padding: 8px; }

/* WAN Policy category-based drag-and-drop */
.wan-policy-container { display: flex; flex-direction: column; gap: 15px; }
.wan-policy-category { background: #fff; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; }
.wan-category-header { padding: 8px 12px; font-weight: 600; font-size: 13px; color: #fff; }
.wan-category-header.priority-1 { background: #2c3e50; }
.wan-category-header.priority-2 { background: #34495e; }
.wan-category-header.priority-3 { background: #5d6d7e; }
.wan-category-header.priority-disabled { background: #7f8c8d; }
.wan-category-label { font-weight: 400; opacity: 0.8; font-size: 11px; }
.wan-category-dropzone { min-height: 50px; padding: 8px; background: #f5f6f7; border: 2px dashed transparent; transition: all 0.2s; }
.wan-category-dropzone.drag-over { border-color: #2c3e50; background: #e8eaed; }
.wan-category-dropzone:empty::before { content: 'Drag interfaces here'; display: block; text-align: left; color: #95a5a6; padding: 12px 8px; font-size: 12px; }
.wan-policy-row { display: flex; align-items: stretch; background: #fff; border-radius: 4px; margin-bottom: 6px; border: 1px solid #ddd; transition: all 0.15s; }
.wan-policy-row:last-child { margin-bottom: 0; }
.wan-policy-row:hover { border-color: #2c3e50; }
.wan-policy-row.dragging { opacity: 0.5; border-color: #2c3e50; }
.wan-policy-left { display: flex; align-items: center; gap: 12px; background: #ecf0f1; padding: 10px 110px 10px 10px; border-right: 1px solid #ddd; width: 260px; flex-shrink: 0; }
.wan-drag-handle { color: #7f8c8d; font-size: 16px; cursor: grab; padding: 4px 8px; margin: -4px; border-radius: 3px; transition: background 0.15s; -webkit-user-select: none; user-select: none; }
.wan-drag-handle:hover { background: rgba(0,0,0,0.08); }
.wan-drag-handle:active { cursor: grabbing; background: rgba(0,0,0,0.12); }
.wan-iface-icon { display: flex; flex-direction: column; align-items: center; gap: 1px; min-width: 14px; }
.wan-iface-icon .eth-row { display: flex; gap: 1px; }
.wan-iface-icon .eth-box { width: 5px; height: 5px; background: #2c3e50; }
.wan-iface-icon.wifi::before { content: ""; display: block; width: 12px; height: 12px; background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232c3e50'%3E%3Cpath d='M12 18c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm-4.9-2.3l1.4 1.4C9.5 18 10.7 18.5 12 18.5s2.5-.5 3.5-1.4l1.4-1.4c-1.4-1.3-3.1-2-5-2s-3.5.7-4.9 2zM2.8 10.8l1.4 1.4c2.1-2.1 5-3.4 7.8-3.4s5.7 1.3 7.8 3.4l1.4-1.4C18.8 8.4 15.5 7 12 7s-6.8 1.4-9.2 3.8z'/%3E%3C/svg%3E") no-repeat center; }
.wan-iface-icon.cellular::before { content: ""; display: block; width: 12px; height: 12px; background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232c3e50'%3E%3Cpath d='M2 22h2V12H2v10zm4 0h2V9H6v13zm4 0h2V6h-2v16zm4 0h2V3h-2v19zm4 0h2V0h-2v22z'/%3E%3C/svg%3E") no-repeat center; }
.wan-iface-icon.usb::before { content: ""; display: block; width: 12px; height: 12px; background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232c3e50'%3E%3Cpath d='M15 7v4h1v2h-3V5h2l-3-4-3 4h2v8H8v-2.07c.7-.37 1.2-1.08 1.2-1.93 0-1.21-.99-2.2-2.2-2.2-1.21 0-2.2.99-2.2 2.2 0 .85.5 1.56 1.2 1.93V13c0 1.11.89 2 2 2h3v3.05c-.71.37-1.2 1.1-1.2 1.95 0 1.22.99 2.2 2.2 2.2 1.21 0 2.2-.98 2.2-2.2 0-.85-.49-1.58-1.2-1.95V15h3c1.11 0 2-.89 2-2v-2h1V7h-4z'/%3E%3C/svg%3E") no-repeat center; }
.wan-policy-name { font-weight: 600; color: #3498db; font-size: 13px; text-decoration: underline; text-underline-offset: 3px; cursor: pointer; position: relative; z-index: 10; pointer-events: auto; margin-right: auto; }
.wan-policy-name:hover { color: #2980b9; text-decoration: underline; text-decoration-thickness: 2px; }
.wan-policy-middle { display: flex; align-items: center; justify-content: flex-start; padding: 10px 20px 10px 40px; flex: 1; }
.wan-policy-status { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #2c3e50; }
.wan-status-indicator { width: 12px; height: 12px; background: #95a5a6; }
.wan-status-indicator.connected { background: #27ae60; box-shadow: 0 0 8px rgba(39, 174, 96, 0.6); }
.wan-status-indicator.disconnected { background: #e74c3c; box-shadow: 0 0 8px rgba(231, 76, 60, 0.6); }
.wan-status-indicator.disabled { background: #95a5a6; box-shadow: none; }
.wan-status-indicator.loading { background: transparent; border: 2px solid #ddd; border-top-color: #3498db; border-radius: 50%; animation: wan-spin 0.6s linear infinite; box-shadow: none; width: 10px; height: 10px; }
@keyframes wan-spin { to { transform: rotate(360deg); } }
.tile-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #ddd; border-top-color: #3498db; border-radius: 50%; animation: wan-spin 0.6s linear infinite; }
.loading-row td { text-align: center; padding: 20px; }
.content-spinner { display: inline-block; width: 24px; height: 24px; border: 3px solid #ddd; border-top-color: #3498db; border-radius: 50%; animation: wan-spin 0.6s linear infinite; vertical-align: middle; margin-right: 8px; }
.wan-policy-right { display: flex; align-items: center; justify-content: flex-start; padding: 10px 20px 10px 40px; flex: 1; }
.wan-policy-ip { font-family: monospace; color: #3498db; font-size: 12px; cursor: pointer; text-decoration: underline; text-underline-offset: 2px; }
.wan-policy-ip:hover { color: #2980b9; text-decoration-thickness: 2px; }
.wan-policy-ip.no-ip { color: #95a5a6; cursor: default; text-decoration: none; }
.wan-ip-popup { position: fixed; background: #fff; border: 1px solid #ddd; border-radius: 6px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 0; z-index: 1000; min-width: 280px; font-size: 12px; }
.wan-ip-popup-header { background: #2c3e50; color: #fff; padding: 10px 12px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; border-radius: 5px 5px 0 0; }
.wan-ip-popup-close { cursor: pointer; font-size: 18px; line-height: 1; opacity: 0.8; }
.wan-ip-popup-close:hover { opacity: 1; }
.wan-ip-popup-body { padding: 12px; }
.wan-ip-popup-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; }
.wan-ip-popup-row:last-child { border-bottom: none; }
.wan-ip-popup-label { color: #7f8c8d; }
.wan-ip-popup-value { font-family: monospace; color: #2c3e50; text-align: right; }

/* WAN Edit Popup */
.wan-edit-popup { position: fixed; background: #fff; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); z-index: 1001; min-width: 420px; max-width: 500px; font-size: 13px; }
.wan-edit-popup-header { background: #2c3e50; color: #fff; padding: 12px 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; border-radius: 7px 7px 0 0; }
.wan-edit-popup-close { cursor: pointer; font-size: 20px; line-height: 1; opacity: 0.8; }
.wan-edit-popup-close:hover { opacity: 1; }
.wan-edit-popup-body { padding: 15px; max-height: 70vh; overflow-y: auto; }
.wan-edit-section { margin-bottom: 18px; }
.wan-edit-section:last-child { margin-bottom: 0; }
.wan-edit-section-title { font-weight: 600; font-size: 12px; color: #2c3e50; text-transform: uppercase; letter-spacing: 0.5px; padding-bottom: 8px; margin-bottom: 12px; border-bottom: 1px solid #eee; }
.wan-edit-row { display: flex; align-items: center; margin-bottom: 10px; }
.wan-edit-row:last-child { margin-bottom: 0; }
.wan-edit-label { width: 110px; color: #7f8c8d; font-size: 12px; flex-shrink: 0; }
.wan-edit-input { flex: 1; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; font-family: inherit; }
.wan-edit-input:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
.wan-edit-input:disabled { background: #f5f5f5; color: #999; }
.wan-edit-select { flex: 1; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; background: #fff; cursor: pointer; }
.wan-edit-select:focus { outline: none; border-color: #3498db; }
.wan-edit-checkbox { width: 18px; height: 18px; cursor: pointer; }
.wan-edit-checkbox-label { margin-left: 8px; color: #2c3e50; cursor: pointer; }
.wan-edit-radio { margin-right: 6px; cursor: pointer; }
.wan-edit-radio-label { margin-right: 20px; cursor: pointer; color: #2c3e50; }
.wan-edit-static-fields { margin-top: 10px; padding: 12px; background: #f8f9fa; border-radius: 4px; display: none; }
.wan-edit-static-fields.visible { display: block; }
.wan-edit-dns-fields { margin-top: 10px; padding: 12px; background: #f8f9fa; border-radius: 4px; display: none; }
.wan-edit-dns-fields.visible { display: block; }
.wan-edit-actions { display: flex; justify-content: flex-end; gap: 10px; padding-top: 15px; margin-top: 15px; border-top: 1px solid #eee; }
.wan-edit-btn { padding: 10px 20px; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
.wan-edit-btn-save { background: #3498db; color: #fff; }
.wan-edit-btn-save:hover { background: #2980b9; }
.wan-edit-btn-save:disabled { background: #bdc3c7; cursor: not-allowed; }
.wan-edit-btn-cancel { background: #ecf0f1; color: #7f8c8d; }
.wan-edit-btn-cancel:hover { background: #ddd; }
.wan-edit-error { color: #e74c3c; font-size: 12px; margin-top: 5px; }
.wan-edit-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); z-index: 1000; }

/* Advanced Settings Collapsible Section */
.wan-advanced-section { margin-top: 20px; }
.wan-advanced-toggle { background: #2c3e50; color: #fff; padding: 12px 15px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: background 0.2s; }
.wan-advanced-toggle:hover { background: #34495e; }
.wan-advanced-arrow { font-size: 10px; transition: transform 0.2s; }
.wan-advanced-arrow.open { transform: rotate(90deg); }
.wan-advanced-content { display: none; margin-top: 10px; background: #fff; border-radius: 6px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
.wan-advanced-content.visible { display: block; }
.wan-advanced-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
@media (max-width: 800px) { .wan-advanced-grid { grid-template-columns: 1fr; } }
.wan-advanced-col { }
.wan-advanced-title { font-weight: 600; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 0.5px; padding-bottom: 8px; margin-bottom: 10px; border-bottom: 1px solid #eee; }
.wan-advanced-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 12px; }
.wan-advanced-row:last-child { margin-bottom: 0; }
.wan-advanced-label { width: 120px; color: #7f8c8d; flex-shrink: 0; }
.wan-advanced-input { width: 70px; padding: 5px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center; }
.wan-advanced-input:focus { outline: none; border-color: #3498db; }
.wan-advanced-select { flex: 1; padding: 5px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; background: #fff; cursor: pointer; max-width: 150px; }
.wan-advanced-select:focus { outline: none; border-color: #3498db; }
.wan-advanced-unit { margin-left: 5px; color: #95a5a6; font-size: 11px; }
.wan-advanced-actions { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
.wan-advanced-btn { padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
.wan-advanced-btn-save { background: #3498db; color: #fff; }
.wan-advanced-btn-save:hover { background: #2980b9; }
.wan-advanced-btn-save:disabled { background: #bdc3c7; cursor: not-allowed; }
.wan-advanced-error { color: #e74c3c; font-size: 11px; margin-top: 8px; display: none; }
.wan-advanced-success { color: #27ae60; font-size: 11px; margin-top: 8px; display: none; }

/* WAN Interface Selector */
.wan-iface-selector { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; }
.wan-iface-selector-title { font-weight: 600; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
.wan-iface-selector-desc { font-size: 11px; color: #95a5a6; margin-bottom: 12px; }
.wan-iface-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; max-height: 200px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 6px; }
.wan-iface-item { display: flex; align-items: center; gap: 8px; padding: 6px 10px; background: #fff; border-radius: 4px; border: 1px solid #e0e0e0; cursor: pointer; transition: all 0.15s; font-size: 12px; overflow: hidden; position: relative; }
.wan-iface-item:hover { border-color: #3498db; background: #f0f7ff; }
.wan-iface-item[data-tooltip]:hover::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #2c3e50; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 11px; white-space: nowrap; z-index: 100; margin-bottom: 4px; }
.wan-iface-item.checked { border-color: #3498db; background: #e8f4fc; }
.wan-iface-item input[type="checkbox"] { margin: 0; cursor: pointer; flex-shrink: 0; }
.wan-iface-item-name { font-weight: 500; color: #2c3e50; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; min-width: 0; }
.wan-iface-item-device { font-size: 10px; color: #95a5a6; margin-left: auto; }
.wan-iface-actions { margin-top: 12px; display: flex; gap: 10px; align-items: center; }
.wan-iface-btn { padding: 6px 14px; border: none; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
.wan-iface-btn-apply { background: #27ae60; color: #fff; }
.wan-iface-btn-apply:hover { background: #229954; }
.wan-iface-btn-cancel { background: #95a5a6; color: #fff; }
.wan-iface-btn-cancel:hover { background: #7f8c8d; }
.wan-iface-status { font-size: 11px; margin-left: auto; }

/* VPS Bypass Toggle */
.bypass-banner { background: #fff; border-radius: 8px; padding: 15px 20px; margin-top: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); display: flex; align-items: center; justify-content: space-between; gap: 20px; }
.bypass-banner.active { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border: 2px solid #f57c00; }
.bypass-left { display: flex; align-items: center; gap: 15px; }
.bypass-icon { font-size: 24px; }
.bypass-text { }
.bypass-title { font-weight: 600; font-size: 14px; color: #2c3e50; }
.bypass-banner.active .bypass-title { color: #e65100; }
.bypass-desc { font-size: 12px; color: #7f8c8d; margin-top: 2px; }
.bypass-banner.active .bypass-desc { color: #bf360c; }
.bypass-toggle { position: relative; width: 60px; height: 32px; flex-shrink: 0; }
.bypass-toggle input { opacity: 0; width: 0; height: 0; }
.bypass-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #95a5a6; transition: 0.3s; border-radius: 32px; }
.bypass-slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 3px; bottom: 3px; background-color: white; transition: 0.3s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
.bypass-toggle input:checked + .bypass-slider { background-color: #f57c00; }
.bypass-toggle input:checked + .bypass-slider:before { transform: translateX(28px); }
.bypass-toggle input:disabled + .bypass-slider { opacity: 0.6; cursor: not-allowed; }
.wan-policy-disabled { opacity: 0.5; pointer-events: none; }
.wan-policy-disabled .wan-category-dropzone { background: #e0e0e0; }
.wan-policy-disabled-overlay { background: rgba(255,255,255,0.7); padding: 20px; text-align: center; border-radius: 6px; margin-top: 10px; }
.wan-policy-disabled-overlay p { color: #7f8c8d; margin: 0; font-size: 13px; }

/* Storage Setup Wizard */
.storage-setup-banner { background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); border: 2px solid #bdc3c7; border-radius: 12px; padding: 24px; margin-bottom: 24px; position: relative; }
.storage-setup-banner.needs-setup { border-color: #f39c12; background: linear-gradient(135deg, #fffbf0 0%, #fff 100%); }
.storage-step { color: #bdc3c7; font-size: 13px; padding-bottom: 8px; border-bottom: 2px solid #ecf0f1; }
.storage-step.active { color: #3498db; border-color: #3498db; font-weight: 500; }
.storage-device-option { padding: 16px; border: 2px solid #ecf0f1; border-radius: 8px; cursor: pointer; transition: all 0.2s; margin-bottom: 12px; }
.storage-device-option:hover:not(.disabled) { border-color: #3498db; background: #f8f9fa; }
.storage-device-option.selected { border-color: #3498db; background: #ebf5fb; }
.storage-device-option.disabled { opacity: 0.5; cursor: not-allowed; }
.storage-close-btn { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 24px; color: #7f8c8d; cursor: pointer; line-height: 1; padding: 0; }
.storage-close-btn:hover { color: #2c3e50; }
</style>

<div class="jm-container">
    <div class="jm-sidebar">
        <div class="jm-sidebar-section">General</div>
        <div class="jm-sidebar-item active" data-view="overview">Overview</div>
        <div class="jm-sidebar-item" data-view="wan-policy">WAN Policy</div>
        <div class="jm-sidebar-item" data-view="links">Interfaces</div>
        <div class="jm-sidebar-item" data-view="clients">Client List</div>
        <div class="jm-sidebar-item" data-view="wifi-aps">Wi-Fi APs</div>
        <div class="jm-sidebar-item" data-view="omr-status">OMR Status</div>
        <div class="jm-sidebar-item" data-view="diagnostics">Diagnostics</div>
        <div class="jm-sidebar-section">Bandwidth</div>
        <div class="jm-sidebar-item" data-view="bw-realtime">Realtime</div>
        <div class="jm-sidebar-item" data-view="bw-hourly">Hourly</div>
        <div class="jm-sidebar-item" data-view="bw-daily">Daily</div>
        <div class="jm-sidebar-item" data-view="bw-monthly">Monthly</div>
        <div class="jm-settings-btn" id="jm-settings-btn" onclick="JamMonitor.showSettingsPopup()">üîß Settings<span class="jm-settings-badge" id="jm-settings-badge"></span></div>
    </div>

    <div class="jm-main">
        <!-- OVERVIEW -->
        <div id="view-overview" class="jm-view active">
            <h2 style="margin-top:0;color:#2c3e50;">Overview</h2>
            <div class="jm-grid">
                <!-- 1. VPN/Tunnel -->
                <div class="jm-block" id="block-vpn">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="vpn-indicator"></span>
                        <span class="jm-block-title">VPN / Tunnel</span>
                    </div>
                    <div class="jm-big-value" id="vpn-ip">--</div>
                    <div class="jm-big-label">Tunnel IP</div>
                    <div class="jm-row"><span class="jm-label">Interface</span><span class="jm-value" id="vpn-iface">--</span></div>
                    <div class="jm-row"><span class="jm-label">Status</span><span class="jm-value" id="vpn-status">--</span></div>
                    <div class="jm-row"><span class="jm-label">Endpoint</span><span class="jm-value" id="vpn-endpoint">--</span></div>
                    <div class="jm-row"><span class="jm-label">Uptime</span><span class="jm-value" id="vpn-handshake">--</span></div>
                </div>

                <!-- 2. System -->
                <div class="jm-block" id="block-system">
                    <div class="jm-block-header">
                        <span class="jm-indicator green" id="sys-indicator"></span>
                        <span class="jm-block-title">System</span>
                    </div>
                    <div class="jm-big-value" id="sys-temp-big">--</div>
                    <div class="jm-big-label" data-i18n="CPU Temperature">CPU Temperature</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Load (1/5/15)">Load (1/5/15)</span><span class="jm-value" id="sys-load">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="CPU Usage">CPU Usage</span><span class="jm-value" id="sys-cpu">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="RAM Usage">RAM Usage</span><span class="jm-value" id="sys-ram">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Conntrack">Conntrack</span><span class="jm-value" id="sys-conntrack">--</span></div>
                </div>

                <!-- 3. WAN IPv4 -->
                <div class="jm-block" id="block-wan">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="wan-indicator"></span>
                        <span class="jm-block-title">WAN IPv4</span>
                    </div>
                    <div class="jm-big-value" id="wan-ip">--</div>
                    <div class="jm-big-label" data-i18n="Public IP">Public IP</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Interface">Interface</span><span class="jm-value" id="wan-iface">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Gateway">Gateway</span><span class="jm-value" id="wan-gw">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Status">Status</span><span class="jm-value" id="wan-status">--</span></div>
                </div>

                <!-- 4. Ping: Internet -->
                <div class="jm-block" id="block-ping-inet">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="ping-inet-indicator"></span>
                        <span class="jm-block-title" data-i18n="Ping: Internet">Ping: Internet</span>
                        <span class="jm-block-status" id="ping-inet-target">1.1.1.1</span>
                    </div>
                    <div class="jm-big-value" id="ping-inet-val">--</div>
                    <div class="jm-big-label" data-i18n="Latency (ms)">Latency (ms)</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Packet Loss">Packet Loss</span><span class="jm-value" id="ping-inet-loss">--%</span></div>
                    <canvas class="jm-mini-graph" id="graph-ping-inet"></canvas>
                </div>

                <!-- 5. Ping: VPS -->
                <div class="jm-block" id="block-ping-vps">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="ping-vps-indicator"></span>
                        <span class="jm-block-title">Ping: VPS</span>
                        <span class="jm-block-status" id="ping-vps-target">--</span>
                    </div>
                    <div class="jm-big-value" id="ping-vps-val">--</div>
                    <div class="jm-big-label" data-i18n="Latency (ms)">Latency (ms)</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Packet Loss">Packet Loss</span><span class="jm-value" id="ping-vps-loss">--%</span></div>
                    <canvas class="jm-mini-graph" id="graph-ping-vps"></canvas>
                </div>

                <!-- 6. Ping: Tunnel Peer -->
                <div class="jm-block" id="block-ping-tunnel">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="ping-tunnel-indicator"></span>
                        <span class="jm-block-title" data-i18n="Ping: Tunnel Peer">Ping: Tunnel Peer</span>
                        <span class="jm-block-status" id="ping-tunnel-target">--</span>
                    </div>
                    <div class="jm-big-value" id="ping-tunnel-val">--</div>
                    <div class="jm-big-label" data-i18n="Latency (ms)">Latency (ms)</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Packet Loss">Packet Loss</span><span class="jm-value" id="ping-tunnel-loss">--%</span></div>
                    <canvas class="jm-mini-graph" id="graph-ping-tunnel"></canvas>
                </div>

                <!-- 7. Uptime -->
                <div class="jm-block" id="block-uptime">
                    <div class="jm-block-header">
                        <span class="jm-indicator green"></span>
                        <span class="jm-block-title" data-i18n="Uptime">Uptime</span>
                    </div>
                    <div class="jm-big-value" id="uptime-val">--</div>
                    <div class="jm-big-label" data-i18n="System Uptime">System Uptime</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Boot Time">Boot Time</span><span class="jm-value" id="boot-time">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Local Time">Local Time</span><span class="jm-value" id="local-time">--</span></div>
                </div>

                <!-- 8. MPTCP -->
                <div class="jm-block" id="block-mptcp">
                    <div class="jm-block-header">
                        <span class="jm-indicator gray" id="mptcp-indicator"></span>
                        <span class="jm-block-title">MPTCP</span>
                    </div>
                    <div class="jm-big-value" id="mptcp-subflows">--</div>
                    <div class="jm-big-label" data-i18n="Active Subflows">Active Subflows</div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Connections">Connections</span><span class="jm-value" id="mptcp-conns">--</span></div>
                    <div class="jm-row"><span class="jm-label" data-i18n="Interfaces">Interfaces</span><span class="jm-value" id="mptcp-ifaces">--</span></div>
                </div>

                <!-- 9. Throughput -->
                <div class="jm-block" id="block-throughput">
                    <div class="jm-block-header">
                        <span class="jm-indicator green"></span>
                        <span class="jm-block-title">Throughput</span>
                    </div>
                    <div style="display:flex;gap:30px;">
                        <div style="min-width:100px;">
                            <div class="jm-big-value" id="tp-down" style="color:#27ae60;font-size:20px;white-space:nowrap;">--</div>
                            <div class="jm-big-label" data-i18n="Download">Download</div>
                        </div>
                        <div style="min-width:100px;">
                            <div class="jm-big-value" id="tp-up" style="color:#e74c3c;font-size:20px;white-space:nowrap;">--</div>
                            <div class="jm-big-label" data-i18n="Upload">Upload</div>
                        </div>
                    </div>
                    <canvas class="jm-mini-graph" id="graph-throughput" style="margin-top:10px;"></canvas>
                </div>
            </div>
        </div>

        <!-- WAN POLICY -->
        <div id="view-wan-policy" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="WAN Policy">WAN Policy</h2>

            <p style="color:#7f8c8d;margin-bottom:15px;" id="wan-policy-hint" data-i18n="Drag interfaces to change their bonding status. Primary accepts only one WAN.">Drag interfaces to change their bonding status. Primary accepts only one WAN.</p>

            <div class="wan-policy-container" id="wan-policy-container">
                <div class="wan-policy-category" data-priority="master">
                    <div class="wan-category-header priority-1"><span data-i18n="Primary">Primary</span> <span class="wan-category-label" data-i18n="(1 max - others bond to this)">(1 max - others bond to this)</span></div>
                    <div class="wan-category-dropzone" data-priority="master"></div>
                </div>
                <div class="wan-policy-category" data-priority="on">
                    <div class="wan-category-header priority-2"><span data-i18n="Bonded">Bonded</span> <span class="wan-category-label" data-i18n="(aggregated with Primary)">(aggregated with Primary)</span></div>
                    <div class="wan-category-dropzone" data-priority="on"></div>
                </div>
                <div class="wan-policy-category" data-priority="backup">
                    <div class="wan-category-header priority-3"><span data-i18n="Standby">Standby</span> <span class="wan-category-label" data-i18n="(failover only)">(failover only)</span></div>
                    <div class="wan-category-dropzone" data-priority="backup"></div>
                </div>
                <div class="wan-policy-category" data-priority="off">
                    <div class="wan-category-header priority-disabled"><span data-i18n="Disabled">Disabled</span></div>
                    <div class="wan-category-dropzone" data-priority="off"></div>
                </div>
            </div>

            <!-- VPS Bypass Banner -->
            <div class="bypass-banner" id="bypass-banner">
                <div class="bypass-left">
                    <span class="bypass-icon" id="bypass-icon">&#128274;</span>
                    <div class="bypass-text">
                        <div class="bypass-title" id="bypass-title">VPS Bypass: OFF</div>
                        <div class="bypass-desc" id="bypass-desc">Traffic routed through VPS via MPTCP bonding</div>
                    </div>
                </div>
                <label class="bypass-toggle">
                    <input type="checkbox" id="bypass-checkbox" onchange="JamMonitor.toggleBypass()">
                    <span class="bypass-slider"></span>
                </label>
            </div>

            <div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:6px;font-size:12px;color:#7f8c8d;line-height:1.6;" id="wan-priority-explanation">
                <strong style="color:#2c3e50;" data-i18n="How WAN Priority Works:">How WAN Priority Works:</strong><br>
                <span data-i18n="Primary ‚Äî The main connection (only one allowed). All MPTCP traffic originates from this interface."><strong>Primary</strong> ‚Äî The main connection (only one allowed). All MPTCP traffic originates from this interface.</span><br>
                <span data-i18n="Bonded ‚Äî These interfaces work together with Primary simultaneously. Traffic is split across all of them for bandwidth aggregation. More bonded connections = more combined bandwidth."><strong>Bonded</strong> ‚Äî These interfaces work <em>together</em> with Primary simultaneously. Traffic is split across all of them for bandwidth aggregation. More bonded connections = more combined bandwidth.</span><br>
                <span data-i18n="Standby ‚Äî Failover connections that remain dormant until Primary and Bonded interfaces fail. When failover occurs, all Standby interfaces activate together."><strong>Standby</strong> ‚Äî Failover connections that remain dormant until Primary and Bonded interfaces fail. When failover occurs, all Standby interfaces activate together.</span><br>
                <span data-i18n="Disabled ‚Äî Interface is completely turned off and not used."><strong>Disabled</strong> ‚Äî Interface is completely turned off and not used.</span><br>
                <span style="color:#95a5a6;font-style:italic;" data-i18n="Tip: Click on a WAN name to edit its settings.">Tip: Click on a WAN name to edit its settings.</span>
            </div>

            <!-- Advanced Settings Collapsible Section -->
            <div class="wan-advanced-section">
                <div class="wan-advanced-toggle" onclick="JamMonitor.toggleAdvancedSettings()">
                    <span class="wan-advanced-arrow" id="wan-advanced-arrow">‚ñ∂</span>
                    <span data-i18n="Advanced Settings">Advanced Settings</span>
                </div>
                <div id="wan-advanced-content" class="wan-advanced-content">
                    <!-- WAN Interface Selector (at top) -->
                    <div class="wan-iface-selector" style="margin-top:0;padding-top:0;border-top:none;">
                        <div class="wan-iface-selector-title" data-i18n="Manage WAN Interfaces">Manage WAN Interfaces</div>
                        <div class="wan-iface-selector-desc" data-i18n="Select which network interfaces should appear in the WAN Policy manager. Check interfaces you want to manage for bonding/failover.">Select which network interfaces should appear in the WAN Policy manager. Check interfaces you want to manage for bonding/failover.</div>
                        <div class="wan-iface-grid" id="wan-iface-grid">
                            <!-- Populated by JS -->
                            <div style="color:#95a5a6;font-size:11px;grid-column:1/-1;text-align:center;padding:20px;" data-i18n="Loading interfaces...">Loading interfaces...</div>
                        </div>
                        <span class="wan-iface-status" id="wan-iface-status" style="font-size:11px;margin-top:8px;display:block;"></span>
                    </div>

                    <div class="wan-advanced-grid">
                        <!-- Failover Detection Column -->
                        <div class="wan-advanced-col">
                            <div class="wan-advanced-title" data-i18n="Failover Detection">Failover Detection</div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Ping Timeout">Ping Timeout</span>
                                <input type="number" class="wan-advanced-input" id="adv-timeout" min="1" max="10" value="1">
                                <span class="wan-advanced-unit" data-i18n="sec">sec</span>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Ping Count">Ping Count</span>
                                <input type="number" class="wan-advanced-input" id="adv-count" min="1" max="5" value="1">
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Checks Before Down">Checks Before Down</span>
                                <input type="number" class="wan-advanced-input" id="adv-tries" min="1" max="10" value="2">
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Check Interval">Check Interval</span>
                                <input type="number" class="wan-advanced-input" id="adv-interval" min="1" max="10" value="1">
                                <span class="wan-advanced-unit" data-i18n="sec">sec</span>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Failure Interval">Failure Interval</span>
                                <input type="number" class="wan-advanced-input" id="adv-failure-interval" min="1" max="30" value="2">
                                <span class="wan-advanced-unit" data-i18n="sec">sec</span>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Checks Before Up">Checks Before Up</span>
                                <input type="number" class="wan-advanced-input" id="adv-tries-up" min="1" max="10" value="2">
                            </div>
                        </div>
                        <!-- MPTCP Bonding Column -->
                        <div class="wan-advanced-col">
                            <div class="wan-advanced-title" data-i18n="MPTCP Bonding">MPTCP Bonding</div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Scheduler">Scheduler</span>
                                <select class="wan-advanced-select" id="adv-scheduler">
                                    <option value="default" data-i18n="default">default</option>
                                    <option value="blest" data-i18n="blest (balanced)">blest (balanced)</option>
                                    <option value="roundrobin" data-i18n="roundrobin">roundrobin</option>
                                    <option value="redundant" data-i18n="redundant (all paths)">redundant (all paths)</option>
                                    <option value="bpf_minrtt" data-i18n="bpf_minrtt (low latency)">bpf_minrtt (low latency)</option>
                                    <option value="bpf_rr" data-i18n="bpf_rr (round-robin)">bpf_rr (round-robin)</option>
                                    <option value="bpf_red" data-i18n="bpf_red (redundant)">bpf_red (redundant)</option>
                                    <option value="bpf_burst" data-i18n="bpf_burst (burst)">bpf_burst (burst)</option>
                                    <option value="bpf_first" data-i18n="bpf_first (first path)">bpf_first (first path)</option>
                                    <option value="bpf_bkup" data-i18n="bpf_bkup (backup)">bpf_bkup (backup)</option>
                                </select>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Path Manager">Path Manager</span>
                                <select class="wan-advanced-select" id="adv-path-manager">
                                    <option value="fullmesh" data-i18n="fullmesh">fullmesh</option>
                                    <option value="ndiffports" data-i18n="ndiffports">ndiffports</option>
                                </select>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Congestion">Congestion</span>
                                <select class="wan-advanced-select" id="adv-congestion">
                                    <option value="bbr" data-i18n="bbr">bbr</option>
                                    <option value="cubic" data-i18n="cubic">cubic</option>
                                    <option value="reno" data-i18n="reno">reno</option>
                                </select>
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Max Subflows">Max Subflows</span>
                                <input type="number" class="wan-advanced-input" id="adv-subflows" min="1" max="16" value="8">
                            </div>
                            <div class="wan-advanced-row">
                                <span class="wan-advanced-label" data-i18n="Stale Loss Count">Stale Loss Count</span>
                                <input type="number" class="wan-advanced-input" id="adv-stale-loss" min="1" max="10" value="4">
                            </div>
                        </div>
                    </div>

                    <div class="wan-advanced-actions">
                        <div id="wan-advanced-error" class="wan-advanced-error"></div>
                        <div id="wan-advanced-success" class="wan-advanced-success"></div>
                        <button class="wan-advanced-btn wan-advanced-btn-save" id="wan-advanced-save-btn" onclick="JamMonitor.saveAdvancedSettings()" data-i18n="Save and Apply">Save and Apply</button>
                        <button class="wan-advanced-btn" style="background:#fff;border:1px solid #e74c3c;color:#e74c3c;margin-left:10px;" onclick="JamMonitor.resetAdvancedSettings()" data-i18n="Reset">Reset</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- INTERFACES -->
        <div id="view-links" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;">Interfaces</h2>
            <div class="jm-grid" id="iface-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                <!-- Populated by JS -->
            </div>
            <div class="jm-block" style="margin-top:20px;">
                <div class="jm-block-header"><span class="jm-block-title">Routing Table</span></div>
                <div id="routing-table" style="font-size:12px;font-family:monospace;overflow-x:auto;"></div>
            </div>
        </div>

        <!-- CLIENTS -->
        <div id="view-clients" class="jm-view">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                <h2 style="margin:0;color:#2c3e50;">Client List</h2>
                <div class="client-actions" style="display:flex;gap:10px;align-items:center;">
                    <span id="client-pending-indicator" style="display:none;font-size:11px;color:#e67e22;">Unsaved changes</span>
                    <button class="wan-advanced-btn wan-advanced-btn-save" id="client-save-btn" onclick="JamMonitor.saveClientChanges()" disabled>Save and Apply</button>
                    <button class="wan-advanced-btn" style="background:#fff;border:1px solid #95a5a6;color:#95a5a6;" id="client-reset-btn" onclick="JamMonitor.resetClientChanges()" disabled>Reset</button>
                </div>
            </div>
            <table class="jm-table" id="clients-table">
                <thead><tr>
                    <th style="width:115px;" data-i18n="IP Address">IP Address</th>
                    <th style="width:40px;" data-i18n="Type">Type</th>
                    <th data-i18n="Name">Name</th>
                    <th data-i18n="Download">Download</th>
                    <th data-i18n="Upload">Upload</th>
                    <th style="width:70px;" data-i18n="Source">Source</th>
                    <th style="width:130px;" data-i18n="MAC Address">MAC Address</th>
                    <th style="width:40px;"></th>
                </tr></thead>
                <tbody id="clients-tbody"></tbody>
            </table>
        </div>

        <!-- WIFI APS -->
        <div id="view-wifi-aps" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;">Wi-Fi APs</h2>

            <!-- Health Tiles -->
            <div class="jm-health-tiles">
                <div class="jm-health-tile">
                    <div class="tile-value" id="wifi-aps-online"><span class="tile-spinner"></span></div>
                    <div class="tile-label" data-i18n="APs Online">APs Online</div>
                </div>
                <div class="jm-health-tile">
                    <div class="tile-value" id="wifi-total-clients"><span class="tile-spinner"></span></div>
                    <div class="tile-label" data-i18n="Total Clients">Total Clients</div>
                </div>
                <div class="jm-health-tile">
                    <div class="tile-value" id="wifi-worst-ap"><span class="tile-spinner"></span></div>
                    <div class="tile-label" data-i18n="Worst AP">Worst AP</div>
                </div>
                <div class="jm-health-tile">
                    <div class="tile-value" id="wifi-local-radios"><span class="tile-spinner"></span></div>
                    <div class="tile-label" data-i18n="Local Radios">Local Radios</div>
                </div>
            </div>

            <!-- Local Radios Section -->
            <div class="jm-block" style="margin-bottom:20px;">
                <div class="jm-block-header"><span class="jm-block-title" data-i18n="Local Radios">Local Radios</span></div>
                <div id="wifi-local-grid" class="jm-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin:0;">
                    <p style="color:#999;margin:15px 0;text-align:center;"><span class="content-spinner"></span>Loading radios...</p>
                </div>
            </div>

            <!-- Connected Clients Section -->
            <div class="jm-block" style="margin-bottom:20px;">
                <div class="jm-block-header">
                    <span class="jm-block-title" data-i18n="Connected Clients">Connected Clients</span>
                </div>
                <table class="jm-table" style="margin-top:10px;">
                    <thead><tr><th data-i18n="Device">Device</th><th data-i18n="MAC Address">MAC Address</th><th data-i18n="Signal">Signal</th><th data-i18n="Download">Download</th><th data-i18n="Upload">Upload</th><th data-i18n="Band">Band</th></tr></thead>
                    <tbody id="wifi-clients-tbody">
                        <tr class="loading-row"><td colspan="6"><span class="content-spinner"></span><span data-i18n="Loading clients...">Loading clients...</span></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Remote APs (collapsible) -->
            <div class="jm-collapsible" style="margin-bottom:20px;">
                <div class="jm-collapsible-header" onclick="JamMonitor.toggleRemoteAps()">
                    <span style="font-size:12px;color:#7f8c8d;">‚ñ∂ Remote APs</span>
                    <span id="remote-ap-count" style="font-size:11px;color:#95a5a6;margin-left:8px;"></span>
                </div>
                <div id="remote-aps-content" class="jm-collapsible-content" style="display:none;">
                    <div style="padding:15px;background:#fff;border-radius:0 0 8px 8px;border:1px solid #eee;border-top:none;">
                        <p style="font-size:11px;color:#7f8c8d;margin:0 0 10px;" data-i18n="Monitor external access points on your network by IP address. Add APs connected to your LAN/switch that you want to track.">Monitor external access points on your network by IP address. Add APs connected to your LAN/switch that you want to track.</p>
                        <div id="remote-ap-editor" style="display:none;margin-bottom:15px;">
                            <p style="font-size:10px;color:#95a5a6;margin:0 0 8px;font-family:monospace;">Example: [{"name":"AP-Living","ip":"10.201.10.50"},{"name":"AP-Garage","ip":"10.201.10.51"}]</p>
                            <textarea id="ap-list-editor" style="width:100%;height:60px;font-family:monospace;font-size:11px;padding:8px;border:1px solid #ddd;border-radius:4px;" placeholder='[{"name":"AP-Living","ip":"10.0.0.2"},{"name":"AP-Office","ip":"10.0.0.3"}]'></textarea>
                            <div style="margin-top:8px;display:flex;gap:8px;">
                                <button class="jm-btn jm-btn-sm" onclick="JamMonitor.saveApList()">Save and Apply</button>
                                <button class="jm-btn jm-btn-sm" style="background:#95a5a6;" onclick="JamMonitor.cancelApEdit()">Cancel</button>
                            </div>
                        </div>
                        <div id="remote-ap-list">
                            <div style="padding:20px;background:#f8f9fa;border-radius:6px;text-align:center;">
                                <p style="color:#95a5a6;margin:0;">No remote APs configured</p>
                                <p style="color:#bdc3c7;font-size:11px;margin:5px 0 0;">Click "+ Add APs" below to monitor external access points</p>
                            </div>
                        </div>
                        <button class="jm-btn jm-btn-sm" style="margin-top:10px;background:#7f8c8d;" id="edit-ap-btn" onclick="JamMonitor.editApList()">+ Add APs</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- OMR STATUS -->
        <div id="view-omr-status" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;">OpenMPTCProuter Status</h2>
            <div class="jm-omr-frame-wrapper">
                <iframe class="jm-omr-frame" id="omr-frame" src="about:blank"></iframe>
            </div>
        </div>

        <!-- DIAGNOSTICS -->
        <div id="view-diagnostics" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="Diagnostics & Data Export">Diagnostics & Data Export</h2>

            <!-- STORAGE SETUP BANNER - only shows when storage not configured -->
            <div id="storage-setup-banner" class="storage-setup-banner needs-setup" style="display:none;">
                <!-- Initial state: Setup needed -->
                <div id="storage-needs-setup">
                    <div style="display:flex;align-items:flex-start;gap:16px;">
                        <span style="font-size:36px;">&#128190;</span>
                        <div style="flex:1;">
                            <h3 style="margin:0 0 8px 0;color:#e67e22;font-size:18px;" data-i18n="USB Storage Setup Required">USB Storage Setup Required</h3>
                            <p style="margin:0 0 16px 0;color:#7f8c8d;font-size:14px;line-height:1.5;" data-i18n="Connect a USB drive to enable historical data collection. JamMonitor stores metrics every minute for trend analysis and debugging.">
                                Connect a USB drive to enable historical data collection. JamMonitor stores metrics every minute for trend analysis and debugging.
                            </p>
                            <button class="jm-btn" onclick="JamMonitor.showStorageSetup()" style="background:#f39c12;border-color:#d68910;" data-i18n="Setup USB Storage">
                                Setup USB Storage
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Setup wizard (expanded) -->
                <div id="storage-wizard" style="display:none;">
                    <button class="storage-close-btn" onclick="JamMonitor.hideStorageSetup()">&times;</button>
                    <h3 style="margin:0 0 20px 0;color:#2c3e50;font-size:18px;" data-i18n="USB Storage Setup">USB Storage Setup</h3>

                    <!-- Step indicators -->
                    <div style="display:flex;gap:24px;margin-bottom:24px;">
                        <div class="storage-step active" id="storage-step-1" data-i18n="1. Select Device">1. Select Device</div>
                        <div class="storage-step" id="storage-step-2" data-i18n="2. Format">2. Format</div>
                        <div class="storage-step" id="storage-step-3" data-i18n="3. Initialize">3. Initialize</div>
                    </div>

                    <!-- Step 1: Device Selection -->
                    <div id="storage-content-1">
                        <div id="storage-device-list">
                            <p style="color:#7f8c8d;" data-i18n="Scanning for USB devices...">Scanning for USB devices...</p>
                        </div>
                        <div style="margin-top:16px;display:flex;gap:12px;flex-wrap:wrap;">
                            <button class="jm-btn" id="storage-use-btn" onclick="JamMonitor.useSelectedDevice()" style="background:#27ae60;border-color:#1e8449;" disabled data-i18n="Use Selected Device">Use Selected Device</button>
                            <button class="jm-btn" id="storage-format-btn" onclick="JamMonitor.goToFormatStep()" style="background:#e74c3c;border-color:#c0392b;" disabled data-i18n="Format & Use">Format & Use</button>
                            <button class="jm-btn" onclick="JamMonitor.loadStorageDevices()" style="background:#ecf0f1;border-color:#bdc3c7;color:#5a6c7d;" data-i18n="Refresh">Refresh</button>
                        </div>
                    </div>

                    <!-- Step 2: Format Confirmation -->
                    <div id="storage-content-2" style="display:none;">
                        <div style="background:#fff5f5;border:1px solid #e74c3c;border-radius:8px;padding:16px;margin-bottom:16px;">
                            <strong style="color:#c0392b;" data-i18n="Warning: Formatting will erase all data on">Warning: Formatting will erase all data on</strong> <strong id="storage-format-device"></strong>!
                            <p style="margin:12px 0 0 0;color:#5a6c7d;" data-i18n="Type FORMAT to confirm:">Type <strong>FORMAT</strong> to confirm:</p>
                            <input type="text" id="storage-format-confirm" placeholder="FORMAT" style="margin-top:8px;padding:8px 12px;border:2px solid #e74c3c;border-radius:6px;font-size:14px;width:120px;text-transform:uppercase;">
                        </div>
                        <div style="display:flex;gap:12px;">
                            <button class="jm-btn" onclick="JamMonitor.formatDevice()" style="background:#e74c3c;border-color:#c0392b;" data-i18n="Format Drive">Format Drive</button>
                            <button class="jm-btn" onclick="JamMonitor.showStorageSetup()" style="background:#ecf0f1;border-color:#bdc3c7;color:#5a6c7d;" data-i18n="Cancel">Cancel</button>
                        </div>
                        <div id="storage-format-status" style="margin-top:12px;"></div>
                    </div>

                    <!-- Step 3: Initialize -->
                    <div id="storage-content-3" style="display:none;">
                        <p style="color:#5a6c7d;" data-i18n="Mounting drive and starting data collection...">Mounting drive and starting data collection...</p>
                        <div id="storage-init-status" style="margin-top:12px;"></div>
                    </div>
                </div>

                <!-- Success state -->
                <div id="storage-success" style="display:none;text-align:center;padding:20px;">
                    <span style="font-size:48px;">&#9989;</span>
                    <h3 style="margin:16px 0 8px 0;color:#27ae60;" data-i18n="USB Storage Ready!">USB Storage Ready!</h3>
                    <p style="color:#7f8c8d;margin:0;" data-i18n="Data collection is now active.">Data collection is now active.</p>
                </div>
            </div>

            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));gap:24px;margin-top:10px;">

                <!-- EMERGENCY SNAPSHOT -->
                <div style="background:linear-gradient(135deg, #fff5f5 0%, #fff 100%);border:2px solid #e74c3c;border-radius:12px;padding:28px;display:flex;flex-direction:column;">
                    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
                        <span style="font-size:36px;">&#128680;</span>
                        <div>
                            <h3 style="margin:0;color:#c0392b;font-size:20px;" data-i18n="Emergency Snapshot">Emergency Snapshot</h3>
                            <span style="color:#e74c3c;font-size:13px;font-weight:500;" data-i18n="Something just broke? Grab this now.">Something just broke? Grab this now.</span>
                        </div>
                    </div>

                    <div style="background:#fff;border-radius:8px;padding:16px;margin-bottom:20px;flex:1;">
                        <div style="color:#2c3e50;font-size:14px;margin-bottom:12px;font-weight:500;" data-i18n="What's inside:">What's inside:</div>
                        <ul style="margin:0;padding-left:20px;color:#5a6c7d;font-size:13px;line-height:1.8;">
                            <li data-i18n="Live system logs (last ~15-30 min)">Live system logs (last ~15-30 min)</li>
                            <li data-i18n="Current routing & interface state">Current routing & interface state</li>
                            <li data-i18n="VPN tunnel status & MPTCP info">VPN tunnel status & MPTCP info</li>
                            <li data-i18n="Active connections & errors">Active connections & errors</li>
                            <li data-i18n="Full system configuration">Full system configuration</li>
                        </ul>
                    </div>

                    <div style="background:#fdf2f2;border-radius:8px;padding:12px;margin-bottom:20px;">
                        <div style="display:flex;align-items:center;gap:8px;color:#c0392b;font-size:12px;">
                            <span style="font-size:14px;">&#8987;</span>
                            <span><strong data-i18n="Time-sensitive:">Time-sensitive:</strong> <span data-i18n="Ring buffer overwrites every 15-30 min. Download immediately after issues occur.">Ring buffer overwrites every 15-30 min. Download immediately after issues occur.</span></span>
                        </div>
                    </div>

                    <button class="jm-btn" id="diag-btn" onclick="JamMonitor.exportDiag()" style="background:#e74c3c;border-color:#c0392b;font-size:15px;padding:14px 24px;width:100%;" data-i18n="Download Emergency Snapshot">
                        Download Emergency Snapshot
                    </button>
                    <div id="diag-status" style="margin-top:12px;text-align:center;"></div>
                </div>

                <!-- HISTORICAL ANALYSIS -->
                <div style="background:linear-gradient(135deg, #f0f9ff 0%, #fff 100%);border:2px solid #3498db;border-radius:12px;padding:28px;display:flex;flex-direction:column;">
                    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
                        <span style="font-size:36px;">&#128202;</span>
                        <div>
                            <h3 style="margin:0;color:#2980b9;font-size:20px;" data-i18n="Historical Analysis">Historical Analysis</h3>
                            <span style="color:#3498db;font-size:13px;font-weight:500;" data-i18n="Investigate trends over days or weeks.">Investigate trends over days or weeks.</span>
                        </div>
                    </div>

                    <div style="background:#fff;border-radius:8px;padding:16px;margin-bottom:20px;flex:1;">
                        <div style="color:#2c3e50;font-size:14px;margin-bottom:12px;font-weight:500;" data-i18n="What's inside:">What's inside:</div>
                        <ul style="margin:0;padding-left:20px;color:#5a6c7d;font-size:13px;line-height:1.8;">
                            <li data-i18n="Ping latency history (1.1.1.1, 8.8.8.8)">Ping latency history (1.1.1.1, 8.8.8.8)</li>
                            <li data-i18n="Interface up/down events">Interface up/down events</li>
                            <li data-i18n="CPU load, RAM, temperature">CPU load, RAM, temperature</li>
                            <li data-i18n="Network state snapshots">Network state snapshots</li>
                            <li data-i18n="Stored on USB - persists across reboots">Stored on USB - persists across reboots</li>
                        </ul>
                    </div>

                    <div style="background:#f0f7fd;border-radius:8px;padding:12px;margin-bottom:20px;">
                        <div style="display:flex;align-items:center;gap:8px;color:#2980b9;font-size:12px;">
                            <span style="font-size:14px;">&#128190;</span>
                            <span><strong data-i18n="Long-term storage:">Long-term storage:</strong> <span data-i18n="Data collected every minute, stored on USB. Use for pattern analysis & historical debugging.">Data collected every minute, stored on USB. Use for pattern analysis & historical debugging.</span></span>
                        </div>
                    </div>

                    <!-- Quick Select -->
                    <div style="margin-bottom:16px;">
                        <label style="color:#5a6c7d;font-size:13px;display:block;margin-bottom:6px;" data-i18n="Time range:">Time range:</label>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;">
                            <button class="jm-quick-range active" data-hours="24" onclick="JamMonitor.setHistoryRange(24, this)" data-i18n="24h">24h</button>
                            <button class="jm-quick-range" data-hours="72" onclick="JamMonitor.setHistoryRange(72, this)" data-i18n="3 days">3 days</button>
                            <button class="jm-quick-range" data-hours="168" onclick="JamMonitor.setHistoryRange(168, this)" data-i18n="7 days">7 days</button>
                            <button class="jm-quick-range" data-hours="336" onclick="JamMonitor.setHistoryRange(336, this)" data-i18n="14 days">14 days</button>
                            <button class="jm-quick-range" data-hours="720" onclick="JamMonitor.setHistoryRange(720, this)" data-i18n="30 days">30 days</button>
                        </div>
                    </div>

                    <!-- Storage status indicator -->
                    <div id="history-storage-info" style="margin-bottom:8px;font-size:12px;color:#7f8c8d;"></div>

                    <!-- Estimate for selected range -->
                    <div id="history-estimate" style="margin-bottom:16px;font-size:13px;color:#2c3e50;font-weight:500;"></div>

                    <!-- Hidden field for hours value -->
                    <input type="hidden" id="history-hours" value="24">

                    <button class="jm-btn" onclick="JamMonitor.downloadHistory()" style="background:#3498db;border-color:#2980b9;font-size:15px;padding:14px 24px;width:100%;" data-i18n="Download Historical Data">
                        Download Historical Data
                    </button>
                    <div id="history-status" style="margin-top:12px;text-align:center;"></div>
                </div>

                <!-- SPEED TEST (full width) -->
                <div style="grid-column:1/-1;background:linear-gradient(135deg, #f0fff4 0%, #fff 100%);border:2px solid #27ae60;border-radius:12px;padding:28px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:16px;">
                        <div style="display:flex;align-items:center;gap:12px;">
                            <span style="font-size:36px;">&#9889;</span>
                            <div>
                                <h3 style="margin:0;color:#27ae60;font-size:20px;" data-i18n="WAN Speed Test">WAN Speed Test</h3>
                                <span style="color:#2ecc71;font-size:13px;font-weight:500;" data-i18n="Test individual WAN throughput (not bonded)">Test individual WAN throughput (not bonded)</span>
                            </div>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                            <span style="color:#7f8c8d;font-size:13px;" data-i18n="Test size:">Test size:</span>
                            <button class="jm-quick-range active" data-size="10" onclick="JamMonitor.setSpeedTestSize(10, this)" data-i18n="Quick 10MB">Quick 10MB</button>
                            <button class="jm-quick-range" data-size="25" onclick="JamMonitor.setSpeedTestSize(25, this)" data-i18n="Normal 25MB">Normal 25MB</button>
                            <button class="jm-quick-range" data-size="100" onclick="JamMonitor.setSpeedTestSize(100, this)" data-i18n="Heavy 100MB">Heavy 100MB</button>
                            <span style="color:#bdc3c7;margin:0 4px;">|</span>
                            <span style="color:#7f8c8d;font-size:13px;" data-i18n="Server:">Server:</span>
                            <select id="speedtest-server" onchange="JamMonitor.setSpeedTestServer(this.value)" style="padding:6px 10px;border:1px solid #ddd;border-radius:6px;font-size:13px;background:#fff;">
                                <option value="cloudflare">Cloudflare ‚Üë‚Üì</option>
                                <option value="china">China ‚Üì</option>
                                <option value="global">Global ‚Üì</option>
                            </select>
                            <span style="color:#95a5a6;font-size:11px;" title="‚Üë‚Üì = upload & download, ‚Üì = download only">(?)</span>
                        </div>
                    </div>

                    <!-- WAN rows container -->
                    <div id="speedtest-wans" style="display:flex;flex-direction:column;gap:10px;">
                        <div style="color:#7f8c8d;font-size:12px;text-align:center;padding:20px;" data-i18n="Loading WAN interfaces...">Loading WAN interfaces...</div>
                    </div>

                    <!-- Error message area -->
                    <div id="speedtest-error" style="display:none;margin-top:12px;padding:12px;background:#fff5f5;border:1px solid #e74c3c;border-radius:8px;color:#c0392b;font-size:12px;"></div>
                </div>

            </div>
        </div>

        <!-- BANDWIDTH: Realtime -->
        <div id="view-bw-realtime" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="Bandwidth - Realtime">Bandwidth - Realtime</h2>
            <div class="jm-bw-controls">
                <label data-i18n="Connection:">Connection:</label>
                <select id="bw-iface-select" onchange="JamMonitor.setInterface(this.value)">
                    <option value="all">All WANs</option>
                </select>
                <label data-i18n="Scale:">Scale:</label>
                <div class="jm-scale-btns">
                    <button class="jm-scale-btn active" data-scale="mb" onclick="JamMonitor.setScale('mb')">MB/s</button>
                    <button class="jm-scale-btn" data-scale="gb" onclick="JamMonitor.setScale('gb')">GB/s</button>
                </div>
            </div>
            <div class="jm-chart-container">
                <div class="chart-loading" id="loading-realtime"><div class="chart-spinner"></div></div>
                <canvas class="jm-chart" id="chart-realtime"></canvas>
            </div>
            <table class="jm-table"><thead><tr><th data-i18n="Time">Time</th><th data-i18n="Download">Download</th><th data-i18n="Upload">Upload</th><th data-i18n="Total">Total</th></tr></thead><tbody id="bw-rt-tbody"></tbody></table>
        </div>

        <!-- BANDWIDTH: Hourly -->
        <div id="view-bw-hourly" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="Bandwidth - Hourly">Bandwidth - Hourly</h2>
            <div class="jm-bw-controls">
                <label data-i18n="Connection:">Connection:</label>
                <select id="bw-hourly-iface" onchange="JamMonitor.loadVnstat('hourly')">
                    <option value="all">All WANs</option>
                </select>
                <label data-i18n="Scale:">Scale:</label>
                <div class="jm-scale-btns">
                    <button class="jm-scale-btn active" data-scale="mb" onclick="JamMonitor.setScale('mb')">MB</button>
                    <button class="jm-scale-btn" data-scale="gb" onclick="JamMonitor.setScale('gb')">GB</button>
                </div>
            </div>
            <div class="jm-chart-container">
                <div class="chart-loading" id="loading-hourly"><div class="chart-spinner"></div></div>
                <canvas class="jm-chart" id="chart-hourly"></canvas>
            </div>
            <table class="jm-table"><thead><tr><th data-i18n="Time">Time</th><th data-i18n="Download">Download</th><th data-i18n="Upload">Upload</th><th data-i18n="Total">Total</th></tr></thead><tbody id="bw-hourly-tbody"></tbody></table>
        </div>

        <!-- BANDWIDTH: Daily -->
        <div id="view-bw-daily" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="Bandwidth - Daily">Bandwidth - Daily</h2>
            <div class="jm-bw-controls">
                <label data-i18n="Connection:">Connection:</label>
                <select id="bw-daily-iface" onchange="JamMonitor.loadVnstat('daily')">
                    <option value="all">All WANs</option>
                </select>
                <label data-i18n="Scale:">Scale:</label>
                <div class="jm-scale-btns">
                    <button class="jm-scale-btn" data-scale="mb" onclick="JamMonitor.setScale('mb')">MB</button>
                    <button class="jm-scale-btn active" data-scale="gb" onclick="JamMonitor.setScale('gb')">GB</button>
                </div>
            </div>
            <div class="jm-chart-container">
                <div class="chart-loading" id="loading-daily"><div class="chart-spinner"></div></div>
                <canvas class="jm-chart" id="chart-daily"></canvas>
            </div>
            <table class="jm-table"><thead><tr><th data-i18n="Date">Date</th><th data-i18n="Download">Download</th><th data-i18n="Upload">Upload</th><th data-i18n="Total">Total</th></tr></thead><tbody id="bw-daily-tbody"></tbody></table>
        </div>

        <!-- BANDWIDTH: Monthly -->
        <div id="view-bw-monthly" class="jm-view">
            <h2 style="margin-top:0;color:#2c3e50;" data-i18n="Bandwidth - Monthly">Bandwidth - Monthly</h2>
            <div class="jm-bw-controls">
                <label data-i18n="Connection:">Connection:</label>
                <select id="bw-monthly-iface" onchange="JamMonitor.loadVnstat('monthly')">
                    <option value="all">All WANs</option>
                </select>
                <label data-i18n="Scale:">Scale:</label>
                <div class="jm-scale-btns">
                    <button class="jm-scale-btn" data-scale="mb" onclick="JamMonitor.setScale('mb')">MB</button>
                    <button class="jm-scale-btn active" data-scale="gb" onclick="JamMonitor.setScale('gb')">GB</button>
                </div>
            </div>
            <div class="jm-chart-container">
                <div class="chart-loading" id="loading-monthly"><div class="chart-spinner"></div></div>
                <canvas class="jm-chart" id="chart-monthly"></canvas>
            </div>
            <table class="jm-table"><thead><tr><th data-i18n="Month">Month</th><th data-i18n="Download">Download</th><th data-i18n="Upload">Upload</th><th data-i18n="Total">Total</th></tr></thead><tbody id="bw-monthly-tbody"></tbody></table>
        </div>
    </div>
</div>

<script src="<%=resource%>/jammonitor-i18n.js?v=1"></script>
<script src="<%=resource%>/jammonitor.js?v=124"></script>

<%+footer%>
